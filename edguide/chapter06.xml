<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
   "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" >
    
<chapter id="chapter06">
<chapterinfo>
<othername>$Author$</othername>
<date>$Date$</date>
</chapterinfo>
<title>Package Editing Policy</title>
<?dbhtml filename="chapter06.html"?>

<para>Each package in the book is written as a complete XML document using the 
<ulink url='http://www.docbook.org/tdg/en/html/docbook.html'>Docbook</ulink>
specification.  This Chapter describes how a BLFS page should be laid out.</para>

<para>The start of the page is the XML header.  The page fits into the overall 
book as a <emphasis>sect1</emphasis> element.  In the header, there should
be a reference to the <filename>general.ent</filename> file which includes
entities that are used in multiple applications.  This includes the version
numbers of all applications, including the current one.  Note that the reference to 
<filename>general.ent</filename> includes the relative address of the file.  
This will be at the root of the BLFS book's source tree and is
normally two levels up from the application files.</para>

<para>Included in the header are the five entities that you see below.  These are
custom entities for each application and are included with each application even if
the entity is only used once.  This is done for consistency between applications.</para>

<para>Units provided should be kilobytes (1024 bytes) or megabytes (1024 kilobytes). 
Entries less than a 1000 kilobytes should be specified as whole numbers (e.g. 320 KB);
larger sizes should be accurate to one decimal (e.g. 6.9 MB). 
SBU entries should be rounded to one decimal if less than 10 SBUs, but listed as 
a whole number if greater than 10 SBUs.</para>

<para>Filesizes should be measured with the <command>ls -h filename</command> command.  Build
sizes should be measured with a <command>du -k /</command> command before the package is 
unpacked and after the package is installed.  The difference between these measurements
is the build size.  Build times should be measured with the procedure documented at
<ulink url='http://www.linuxfromscratch.org/~bdubbs/about.html'/>.</para>

<screen>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
   "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
  &lt;!ENTITY % general-entities SYSTEM "../../general.ent"&gt;
  %general-entities;

&lt;!ENTITY fam-download-http "http://gd.tuwien.ac.at/opsys/linux/gentoo/distfiles/fam-&amp;fam-version;.tar.gz"&gt;
&lt;!ENTITY fam-download-ftp "ftp://oss.sgi.com/projects/fam/download/stable/fam-&amp;fam-version;.tar.gz"&gt;
&lt;!ENTITY fam-size "320 KB"&gt;
&lt;!ENTITY fam-buildsize "6.9 MB"&gt;
&lt;!ENTITY fam-time "0.4 SBU"&gt;
]&gt; </screen>

<para>The application is delimited by &lt;sect1&gt; tags.  The <parameter>id</parameter> 
attribute should be unique in the BLFS book and similar to the application name.
The <parameter>xreflabel</parameter> is the name that will show up in the table of
contents.</para>

<para>The  &lt;sect1info&gt; structure is for Subversion to automatically tag the
date and editor of the most recent change to the file.  It is also used to list
this information as a footnote at the bottom of each page.</para>

<para>The &lt;?dbhtml filename="fam.html"?&gt; line is an SGML processing instruction
that tells the render engine where to place the output of the current page.</para>

<para>Finally, the required &lt;title&gt; section specifies the actual name of the section
at the top of the application's page.  This should normally be the same as the 
<parameter>xreflabel</parameter>.</para>

<para>Note the use of entities in the XML.  This allows the package version to be updated
as entities without having to change the code.</para>


<screen>&lt;sect1 id="fam" xreflabel="FAM-&amp;fam-version;"&gt;
&lt;sect1info&gt;
&lt;othername&gt;$LastChangedBy$&lt;/othername&gt;
&lt;date&gt;$Date$&lt;/date&gt;
&lt;/sect1info&gt;
&lt;?dbhtml filename="fam.html"?&gt;
&lt;title&gt;FAM-&amp;fam-version;&lt;/title&gt;</screen>

<para>The content of the application is normally divided into five areas: Introduction, Installation, 
Command Explanations, Configuration, and Contents.  In some cases, the Configuration is not required.</para>

<sect1>
<title>Introduction Section</title>

<para>The Introduction Section starts with a description of the application.  This description
is generally short, but for less well known applications, multiple paragraphs summarizing the 
application's purpose is appropriate.</para>


<screen>&lt;sect2&gt;
&lt;title&gt;Introduction to &lt;application&gt;&lt;acronym&gt;FAM&lt;/acronym&gt;&lt;/application&gt;&lt;/title&gt;

&lt;para&gt;The &lt;application&gt;&lt;acronym&gt;FAM&lt;/acronym&gt;&lt;/application&gt; package 
contains a File Alteration Monitor which is useful for notifying applications of
changes to the file system.&lt;/para&gt;</screen>

<para>After the description, package locations and statistics are presented.  Here the entities defined
in the header should be used.  If an HTTP or FTP location is not available, leave the
header in place with an empty string for the missing location. </para>

<screen>&lt;sect3&gt;&lt;title&gt;Package information&lt;/title&gt;
&lt;itemizedlist spacing='compact'&gt;
&lt;listitem&gt;&lt;para&gt;Download (HTTP): &lt;ulink url="&amp;fam-download-http;"/&gt;&lt;/para&gt;&lt;/listitem&gt;
&lt;listitem&gt;&lt;para&gt;Download (FTP): &lt;ulink url="&amp;fam-download-ftp;"/&gt;&lt;/para&gt;&lt;/listitem&gt;
&lt;listitem&gt;&lt;para&gt;Download size: &amp;fam-size;&lt;/para&gt;&lt;/listitem&gt;
&lt;listitem&gt;&lt;para&gt;Estimated disk space required: &amp;fam-buildsize;&lt;/para&gt;&lt;/listitem&gt;
&lt;listitem&gt;&lt;para&gt;Estimated build time: &amp;fam-time;&lt;/para&gt;&lt;/listitem&gt;
&lt;/itemizedlist&gt;
&lt;/sect3&gt;</screen>

<para>Following the statistics, come any additional downloads needed.  These files are generally
patches.  If no patches are required, this section should be omitted.</para>


<screen>&lt;sect3&gt;&lt;title&gt;Additional downloads&lt;/title&gt;
&lt;itemizedlist spacing='compact'&gt;
&lt;listitem&gt;&lt;para&gt;Dnotify patch (Recommended): 
   &lt;ulink url="&amp;patch-root;/fam-&amp;fam-version;-dnotify-1.patch"/&gt;&lt;/para&gt;&lt;/listitem&gt;
&lt;/itemizedlist&gt;
&lt;/sect3&gt;</screen>

<para>Next comes dependencies.  This is one of the most important parts of each
application.  Dependencies should be listed as <emphasis>Required</emphasis> or
<emphasis>Optional</emphasis>.  In many cases both are needed.  Required
dependencies are those packages that are needed to build or run the
application.  Since the book assumes that the packages are being built from an
LFS system, no LFS packages should be listed.  If a package and a required
dependency has, in turn, a required dependency in common, the second level
dependency should <emphasis>not</emphasis> be listed.  However, if a required
dependency and the application share an optional dependency, that optional
dependency should be listed.</para>

<para>If a package will take advantage of another package <emphasis>after</emphasis>
it is built, it should  <emphasis>not</emphasis> be listed as a dependency,
however a note may be appropriate.</para>

<screen>&lt;sect3&gt;&lt;title&gt;&lt;application&gt;&lt;acronym&gt;FAM&lt;/acronym&gt;&lt;/application&gt; dependencies
&lt;/title&gt;
&lt;sect4&gt;&lt;title&gt;Required&lt;/title&gt;
&lt;para&gt;&lt;xref linkend="portmap"/&gt;&lt;/para&gt;&lt;/sect4&gt;
&lt;/sect3&gt;

&lt;/sect2&gt;</screen>
</sect1>

<sect1>
<title>Installation Section</title> 

<para>The Installation Section provides the literal instructions needed to
build the application.  The instructions should be inside a
&lt;screen&gt;&lt;userinput&gt;&lt;command&gt; construct and each instruction
(except the last) should terminate with a double ampersand (&amp;&amp;) to
facilitate cut and paste capabilities for the user. Note that the
&lt;screen&gt;&lt;userinput&gt;&lt;command&gt; tags need to be on the same line
as the first and last instruction for the book to render properly.</para>

<screen>&lt;sect2&gt;
&lt;title&gt;Installation of &lt;application&gt;&lt;acronym&gt;FAM&lt;/acronym&gt;&lt;/application&gt;&lt;/title&gt;

&lt;para&gt;Install &lt;application&gt;&lt;acronym&gt;FAM&lt;/acronym&gt;&lt;/application&gt; by running the
following commands:&lt;/para&gt;

&lt;screen&gt;&lt;userinput&gt;&lt;command&gt;patch -Np1 -i ../fam-&amp;fam-version;-dnotify-1.patch &amp;&amp;
chmod 755 configure &amp;&amp;
autoreconf -f -i &amp;&amp;
./configure --prefix=/usr --sysconfdir=/etc &amp;amp;&amp;amp;
make &amp;amp;&amp;amp;
make install&lt;/command&gt;&lt;/userinput&gt;&lt;/screen&gt;

&lt;/sect2&gt;</screen>
</sect1>

<sect1>
<title>Explaination Section</title>

<para>The Explaination Section elaborates on unusual commands and switches.  If
the instructions are common commands such as <userinput>configure &amp;&amp;
make &amp;&amp; make install</userinput>, this section can be omitted.  On the
other hand, this section is the perfect place to explain why a command or
switch is necessary.  If the Installation Section does not include a particular
optional comnand or switch, an entry can be made here giving the user
information about the alternative or supplemental option.  Since many packages
have a large number of options, this explaination is normally reserved for
optional instructions the editor feels are particularly important.</para>

<screen>&lt;sect2&gt;
&lt;title&gt;Command explanations&lt;/title&gt;

&lt;para&gt;&lt;command&gt;patch -Np1 -i ../fam-&amp;fam-version;-dnotify-1.patch&lt;/command&gt;: 
This patch enables &lt;application&gt;&lt;acronym&gt;FAM&lt;/acronym&gt;&lt;/application&gt; to use 
the Linux kernel dnotify mechanism to inform the calling process of
file modifications, rather than polling the file system for
modifications.&lt;/para&gt;

&lt;para&gt;&lt;command&gt;chmod 755 configure&lt;/command&gt;: &lt;command&gt;configure&lt;/command&gt; is 
set to read-only and &lt;command&gt;autoreconf&lt;/command&gt; will fail if the 
permissions aren't changed.&lt;/para&gt;

&lt;para&gt;&lt;command&gt;autoreconf -f -i&lt;/command&gt;: The autotools need rebuilding 
because the dnotify patch affects &lt;filename&gt;configure.ac&lt;/filename&gt; and 
&lt;filename&gt;Makefile.am&lt;/filename&gt;.&lt;/para&gt;

&lt;/sect2&gt;</screen>
</sect1>
 
<sect1>
<title>Configuration Section</title>

<para>This section describes any actions the user needs to take to configure the
application.  If no confiuration is required, then it can be omitted.</para>

<screen>&lt;sect2&gt;
&lt;title&gt;Configuring &lt;application&gt;&lt;acronym&gt;FAM&lt;/acronym&gt;&lt;/application&gt;&lt;/title&gt;

&lt;sect3&gt;&lt;title&gt;Config files&lt;/title&gt;

&lt;para&gt;&lt;filename&gt;/etc/rpc&lt;/filename&gt;,
 &lt;filename&gt;/etc/fam.conf&lt;/filename&gt;,
 &lt;filename&gt;/etc/inetd.conf&lt;/filename&gt;,
 &lt;filename&gt;/etc/xinetd.d/fam&lt;/filename&gt;
 or &lt;filename&gt;/etc/xinetd.conf&lt;/filename&gt;
 &lt;/para&gt;
&lt;/sect3&gt;

&lt;sect3&gt;&lt;title&gt;Configuration Information&lt;/title&gt;

&lt;para&gt;Configuring the file alteration monitor.&lt;/para&gt;

&lt;para&gt;If you use &lt;application&gt;inetd&lt;/application&gt;, add the
&lt;application&gt;&lt;acronym&gt;FAM&lt;/acronym&gt;&lt;/application&gt; entry to
&lt;filename&gt;/etc/inetd.conf&lt;/filename&gt; with the
following command:&lt;/para&gt;

&lt;screen&gt;&lt;userinput&gt;&lt;command&gt;echo "sgi_fam/1-2 stream  rpc/tcp wait root /usr/sbin/famd fam" &gt;&gt; /etc/inetd.conf&lt;/command&gt;&lt;/userinput&gt;&lt;/screen&gt;

&lt;para&gt;If you use &lt;application&gt;xinetd&lt;/application&gt;, add an entry to
&lt;filename&gt;/etc/xinetd.conf&lt;/filename&gt; with the following command (be
sure the "nogroup" group exists):&lt;/para&gt;

&lt;screen&gt;&lt;userinput&gt;&lt;command&gt;cat &gt;&gt; /etc/xinetd.conf &lt;&lt; "EOF"&lt;/command&gt;
    # description: FAM - file alteration monitor
    service sgi_fam
    {
        type            = RPC UNLISTED
        socket_type     = stream
        user            = root
        group           = nogroup
        server          = /usr/sbin/famd
        wait            = yes
        protocol        = tcp
        rpc_version     = 2
        rpc_number      = 391002
    }
&lt;command&gt;EOF&lt;/command&gt;&lt;/userinput&gt;&lt;/screen&gt;

&lt;para&gt;If you do not have an &lt;command&gt;inetd&lt;/command&gt; daemon installed and have 
no wish to install one, you can also start &lt;command&gt;famd&lt;/command&gt; during 
system startup by installing the &lt;filename&gt;/etc/rc.d/init.d/fam&lt;/filename&gt;
init script included in the
&lt;xref linkend="intro-important-bootscripts"/&gt; package.&lt;/para&gt;

&lt;screen&gt;&lt;userinput&gt;&lt;command&gt;make install-fam&lt;/command&gt;&lt;/userinput&gt;&lt;/screen&gt;

&lt;/sect3&gt;

&lt;/sect2&gt;</screen>
</sect1>
 
<sect1>
<title>Contents Section</title>

<para>The final section describes the contents of the application.</para>

<screen>&lt;sect2&gt;
&lt;title&gt;Contents&lt;/title&gt;

&lt;para&gt;The &lt;application&gt;&lt;acronym&gt;FAM&lt;/acronym&gt;&lt;/application&gt; package contains
the &lt;command&gt;famd&lt;/command&gt; executable and &lt;filename&gt;libfam&lt;/filename&gt;
libraries.&lt;/para&gt;

&lt;/sect2&gt;

&lt;sect2&gt;&lt;title&gt;Description&lt;/title&gt;

&lt;sect3&gt;&lt;title&gt;famd&lt;/title&gt;

&lt;para&gt;&lt;command&gt;famd&lt;/command&gt; is the file alteration monitor.&lt;/para&gt;

&lt;/sect3&gt;
&lt;/sect2&gt;
&lt;/sect1&gt;</screen>
</sect1>
</chapter>

