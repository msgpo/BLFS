<sect2>
<title>Configuring <application>libusb</application></title>

<!-- To be reviewed when hotplug enters the LFS book -->

<para>libusb requires the usbfs kernel filesystem to be mounted on
<filename class="directory">/proc/bus/usb</filename>. Applications
require the files in this directory to be accessible to the user,
sometimes for both reading and writing.</para>

<para>To restrict access to <acronym>USB</acronym> devices, create the
usb group:</para>

<screen><userinput><command>groupadd -g 15 usb</command></userinput></screen>

<para>To get usbfs mounted on boot, we will create a special init script,
because just putting an extra line into
<filename>/etc/fstab</filename> does not work for those who compiled
"USB device filesystem" as a kernel module. To do this,
execute the following command:</para>

<screen><userinput><command>cat &gt;/etc/rc.d/init.d/usb &lt;&lt;"EOF"</command>
#!/bin/sh
# Begin $rc_base/init.d/usb

. /etc/sysconfig/rc
. $rc_functions

modprobe usbcore 2&gt;/dev/null || true
# insert a modprobe command for your USB host adapter here, e.g.
# modprobe ehci-hcd 2&gt;/dev/null
# Other host adapters are uhci-hcd and ohci-hcd
# 2.4.x kernels have usb-ehci, usb-uhci, and usb-ohci modules
if ( grep -q usbfs /proc/filesystems )
then
	echo "Mounting USB filesystem"
	mount -o devgid=15,devmode=0660 -t usbfs usbfs /proc/bus/usb
	evaluate_retval
fi
# End $rc_base/init.d/usb
<command>EOF</command></userinput></screen>

<para>Give this script the appropriate permissions and
make a symlink to run it at startup:</para>
<screen><userinput><command>chmod 755 /etc/rc.d/init.d/usb &amp;&amp;
ln -s ../init.d/usb /etc/rc.d/rcsysinit.d/S90usb</command></userinput></screen>

</sect2>
